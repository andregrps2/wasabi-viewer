<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasabi Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Tela de Configuração -->
    <div id="config-screen" class="screen active">
        <div class="config-container">
            <!-- Botão de Configurações na tela inicial -->
            <button id="settings-btn-config" class="btn btn-secondary btn-icon" title="Configurações" style="position:absolute; top:16px; right:16px;">
                <i class="fas fa-cog"></i>
            </button>
            <div class="config-header">
                <h1>
                    <span class="brand-logo" aria-hidden="true">
                        <img src="../../assets/green_leaf_logo.png" alt="Wasabi Logo" class="brand-logo-img">
                    </span>
                    Wasabi Viewer
                </h1>
                <p>Gerencie conexões com seus buckets Wasabi S3</p>
            </div>

            <!-- Menu de Ações -->
            <div class="menu-actions">
                <button id="new-config-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Nova Configuração
                </button>
            </div>

            <!-- Lista de Buckets Salvos -->
            <div id="saved-configs" class="saved-configs">
                <h3>Buckets Salvos</h3>
                <div id="config-list" class="config-list">
                    <div class="empty-configs">
                        <i class="fas fa-plus-circle"></i>
                        <p>Adicione sua primeira configuração abaixo</p>
                    </div>
                </div>
            </div>

            <!-- Seção de Token Compartilhado -->
            <div class="share-section card">
                <h3>Conectar via Token Compartilhado</h3>
                <div class="share-token-input">
                    <input type="text" id="share-token-input" placeholder="Cole o token compartilhado aqui...">
                    <button type="button" id="connect-shared-btn" class="btn btn-primary">
                        <i class="fas fa-key"></i> Conectar
                    </button>
                </div>
            </div>

            <div id="config-status" class="status-message"></div>
        </div>
    </div>

    <!-- Modal de Nova/Editar Configuração -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="config-modal-title">Nova Configuração</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="config-form" class="config-form">
                    <div class="form-group">
                        <label for="accessKey">Access Key:</label>
                        <input type="text" id="accessKey" required>
                    </div>

                    <div class="form-group">
                        <label for="secretKey">Secret Key:</label>
                        <input type="password" id="secretKey" required>
                    </div>

                    <div class="form-group">
                        <label for="configName">Nome da Configuração:</label>
                        <input type="text" id="configName" placeholder="ex: Bucket Principal" required>
                    </div>

                    <div class="form-group">
                        <label for="bucket">Bucket:</label>
                        <input type="text" id="bucket" required>
                    </div>

                    <div class="form-group">
                        <label for="prefix">Prefix (opcional):</label>
                        <input type="text" id="prefix" placeholder="ex: uploads/">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="region">Região:</label>
                            <select id="region" required>
                                <option value="us-east-1">us-east-1</option>
                                <option value="us-west-1">us-west-1</option>
                                <option value="eu-central-1">eu-central-1</option>
                                <option value="ap-northeast-1">ap-northeast-1</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="endpoint">Endpoint:</label>
                            <input type="url" id="endpoint" value="https://s3.wasabisys.com" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> <span id="save-btn-text">Salvar e Conectar</span>
                        </button>
                        <button type="button" id="cancel-modal-btn" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Tela Principal -->
    <div id="main-screen" class="screen">
        <header class="main-header">
            <div class="header-left">
                <h1>
                    <span class="brand-logo" aria-hidden="true">
                        <img src="../../assets/green_leaf_logo.png" alt="Wasabi Logo" class="brand-logo-img">
                    </span>
                    Wasabi Viewer
                </h1>
                <div class="bucket-selector">
                    <select id="bucket-select" class="bucket-select">
                        <option value="">Selecione um bucket...</option>
                    </select>
                </div>
                <button id="config-btn" class="btn btn-secondary" title="Início">
                    <i class="fas fa-home"></i> Início
                </button>
            </div>

            <div class="header-right">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Pesquisar arquivos...">
                    <i class="fas fa-search"></i>
                </div>

                <button id="settings-btn" class="btn btn-secondary btn-icon" title="Configurações">
                    <i class="fas fa-cog"></i>
                </button>

                <button id="refresh-btn" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
            </div>
        </header>

        

        <main class="main-content">
            <!-- Navegação de pastas -->
            <div class="breadcrumb">
                <div class="nav-arrows" aria-label="Navegação">
                    <button id="nav-back" class="nav-arrow-btn" title="Voltar" aria-label="Voltar">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button id="nav-forward" class="nav-arrow-btn" title="Avançar" aria-label="Avançar">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <span id="breadcrumb-path">
                    <i class="fas fa-home"></i> Início
                </span>
            </div>

            <!-- Lista de arquivos -->
            <div class="file-list-container">
                <div class="file-list-header">
                    <div class="column-header name-column sortable" data-sort="name">
                        <i class="fas fa-file"></i> Nome <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header size-column sortable" data-sort="size">
                        <i class="fas fa-weight-hanging"></i> Tamanho <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header date-column sortable" data-sort="date">
                        <i class="fas fa-calendar"></i> Modificado <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header actions-column">
                        <i class="fas fa-tools"></i> Ações
                    </div>
                </div>

                <div id="file-list" class="file-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        Carregando arquivos...
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal de Progress -->
        <div id="progress-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Download em andamento...</h3>
                    <div class="modal-actions">
                        <span id="modal-queue-count" class="modal-queue"></span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                    <span id="progress-percent" class="progress-label">0%</span>
                </div>
                <p id="progress-text">Preparando download...</p>
                <div class="progress-meta" style="margin-top:6px; gap:10px;">
                    <span id="progress-size">0 B / 0 B</span>
                    <span id="progress-eta">—</span>
                </div>
                <div class="progress-actions">
                    <button id="minimize-download-btn" class="btn btn-secondary btn-compact">Minimizar</button>
                    <button id="cancel-download-btn" class="btn btn-danger btn-compact">Cancelar Download</button>
                </div>
            </div>
        </div>

        <!-- Modal de Salvar Arquivo -->
        <div id="save-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Salvar arquivo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="breadcrumb" id="save-breadcrumb"></div>
                    <div id="save-dir-list" class="file-list" style="height: 260px; overflow-y:auto; border:1px solid var(--border-light); border-radius:8px;">
                        <!-- diretórios serão listados aqui -->
                    </div>
                    <div class="form-row" style="margin-top:12px;">
                        <label for="save-file-name">Nome do arquivo</label>
                        <input id="save-file-name" type="text" placeholder="nome.ext" />
                    </div>
                    <div class="form-actions" style="justify-content:center; margin-top:14px;">
                        <button id="save-confirm-btn" class="btn btn-primary">Salvar aqui</button>
                        <button id="save-cancel-btn" class="btn btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal de Confirmação de Cancelamento -->
        <div id="cancel-confirm-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Cancelar Download</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="confirm-actions" style="margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap: wrap;">
                        <button id="cancel-confirm-yes" class="btn btn-danger">Cancelar somente atual</button>
                        <button id="cancel-confirm-all" class="btn btn-warning">Cancelar toda a fila</button>
                        <button id="cancel-confirm-no" class="btn btn-secondary">Manter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Compartilhamento -->
        <div id="share-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Compartilhar Configuração</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="share-info">
                        <p><strong>Configuração:</strong> <span id="share-config-name"></span></p>
                        <p class="share-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Este token contém credenciais de acesso. Compartilhe apenas com pessoas confiáveis.
                        </p>
                    </div>

                    <div class="share-actions">
                        <button id="generate-token-btn" class="btn btn-primary">
                            <i class="fas fa-share"></i> Gerar Token de Compartilhamento
                        </button>
                    </div>

                    <div id="share-result" class="share-result">
                        <label>Token de Compartilhamento:</label>
                        <textarea id="share-token" readonly></textarea>
                        <div class="share-result-actions">
                            <button id="copy-token-btn" class="btn btn-success">
                                <i class="fas fa-copy"></i> Copiar Token
                            </button>
                            <button id="copy-instructions-btn" class="btn btn-info">
                                <i class="fas fa-info-circle"></i> Copiar Instruções
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Link -->
        <div id="link-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Link do Arquivo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="link-options">
                        <button id="signed-link-btn" class="btn btn-primary">
                            <i class="fas fa-key"></i> Gerar Link Temporário (1h)
                        </button>
                    </div>
                    <div class="link-result">
                        <textarea id="generated-link" readonly></textarea>
                        <button id="copy-link-btn" class="btn btn-success">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <!-- Modal de Configurações (fora de main-screen para funcionar também na tela inicial) -->
    <div id="settings-modal" class="modal">
        <div class="modal-content settings-content">
            <div class="modal-header">
                <h3>Configurações</h3>
                <button id="settings-close" class="modal-close" aria-label="Fechar">&times;</button>
            </div>
            <div class="settings-layout">
                <aside class="settings-sidebar">
                    <ul>
                        <li class="settings-tab active" data-tab="preferences">Preferências</li>
                        <li class="settings-tab" data-tab="theme">Tema</li>
                    </ul>
                </aside>
                <section class="settings-body">
                    <div id="settings-section-preferences" class="settings-section active">
                        <h4>Preferências</h4>
                        <div class="setting-item">
                            <label class="setting-label">
                                <input type="checkbox" id="pref-use-default-download">
                                Definir local de download
                            </label>
                            <div class="setting-sub">
                                <div class="setting-path" id="pref-default-download-path">Nenhum diretório definido</div>
                                <button id="pref-choose-download-dir" class="btn btn-secondary btn-small">Selecionar pasta</button>
                            </div>
                        </div>
                    </div>

                    <div id="settings-section-theme" class="settings-section">
                        <h4>Tema</h4>
                        <div class="setting-item">
                            <span class="setting-label">Tema escuro</span>
                            <label class="switch">
                                <input type="checkbox" id="theme-switch">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Mini janela de download (canto inferior direito) -->
    <div id="download-mini" class="download-mini">
        <div class="mini-header">
            <div class="mini-left">
                <span class="mini-title">Download em andamento</span>
                <span id="mini-queue-count" class="mini-queue" aria-live="polite"></span>
            </div>
            <div class="mini-actions">
                <button id="mini-restore-btn" class="btn btn-secondary btn-tiny">Restaurar</button>
                <button id="mini-cancel-btn" class="btn btn-danger btn-tiny">Cancelar</button>
            </div>
        </div>
        <div class="mini-body">
            <div class="progress-bar progress-mini">
                <div id="mini-progress-fill" class="progress-fill"></div>
                <span id="mini-progress-percent" class="progress-label">0%</span>
            </div>
            <div class="progress-meta mini-meta">
                <span id="mini-progress-size">0 B / 0 B</span>
                <span id="mini-progress-eta">—</span>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>

</html>